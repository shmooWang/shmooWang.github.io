---
layout: post
title: "GAMES103-Linear Finite Element Method"
subtitle: "some notes"
author: "Shmoo"
header-img: "img/post-bg-halting.jpg"
header-mask: 0.3
tags:
  - 知乎
  - 图形学
  - 物理仿真
  - 基于物理的动画
---

> 这篇文章转载自 GAMES103-Linear Finite Element Method - Shmoo的文章 - 知乎  https://zhuanlan.zhihu.com/p/11598755651

使用线性有限元方法进行物理模拟的总体想法：
总体目标是：根据当前物体网格每个顶点的位置，计算每个顶点收到的力，从而进行位置的更新。
我们的实现思路是：
对于每个三角形，根据当下顶点的位置x和rest的顶点位置X计算变形梯度 
F
 。
使用公式 
G
=
1
2
(
F
T
F
−
I
)
 计算仅仅描述形变的格林应变Green Strain : 
G
 。
 使用 Saint Venant-Kirchhoff 模型： 
W
(
G
)
=
λ
2
(
ε
u
u
+
ε
v
v
)
2
+
μ
(
ε
u
u
2
+
ε
v
v
2
+
2
ε
u
v
2
)
 计算能量密度 
W
(
G
)
 。
在每个三角形的面积上对能量密度 
W
(
G
)
 
 进行积分，得到总能量 
E
 。
对总能量 
E
 
 关于顶点位置 
x
i
 求导，并加上负号，得到顶点 
x
i
 所受的力 
f
i
=
−
(
∂
E
∂
x
i
)
T
 。
通过这些步骤，我们可以根据当前物体网格每个顶点的位置，计算每个顶点的力，从而计算每个顶点的速度，从而进行位置的更新，实现物理模拟。

关键点解释：
关于什么是线性：
我对于下图中提到的线性的理解是，线性有限元方法假设：对于参考三角形内的每一个点，其变形是通过一个相同的线性变换实现的。这意味着对于这个三角形而言，认为每一个点都发生了相同的线性变化。


添加图片注释，不超过 140 字（可选）
x
=
F
X
+
c
 描述了无形变状态的x到形变后的X的映射过程。其中：
deformation gradient 
F
 
F
 是deformation gradient，包含了旋转和形变。  
c
 
 包含了平移。
我们需要描述形变产生的能量，从而进行物理模拟。能量应该与形变有关，而与旋转无关。所以需要消除 
F
 中的旋转部分。
在连续介质力学中，我们通常需要一个张量来描述形状的变形。回忆一下奇异值分解（SVD），它将任何矩阵 
F
 
 分解为三个矩阵的乘积：

 
F
=
U
D
V
T
 

其中：
 
U
 
 和 
V
 
 是正交矩阵，分别表示旋转。
 
D
 
 是对角矩阵，表示拉伸。
从左往右看，SVD 分解可以将任何一个矩阵（线性变化）描述为三个步骤：
1. 旋转 
V
T
 ：将坐标系旋转到进行拉伸的轴。
2. 拉伸 
D
 ：在这些轴上进行拉伸或压缩。
3. 旋转 
U
 ：将拉伸后的坐标系再旋转到最终的位置。

旋转 
V
T
 
 和 拉伸 
D
 与形变有关：
 
V
T
 
 旋转到进行拉伸的轴，然后进行拉伸，造成形变。
 
D
 
 描述了拉伸的程度，即在各个方向上的伸长或压缩。

旋转 
U
 
 与形变无关：
 
U
 
 代表的是最终的旋转，它不影响形变的程度，只是改变了形变后的坐标系。
Green strain 格林应变张量 
G
 
 
Green strain 仅仅描述了形变，和平移，旋转都无关。形变为0，G为0。形变越大，Green strain也越大。
为了得到只与形变有关的量，我们可以通过 
F
T
F
 
 消除旋转 
U
 
 的影响。具体来说：

 
G
=
1
2
(
F
T
F
−
I
)
 

其中：
 
F
T
F
 
 消除了旋转 
U
 ，保留了拉伸和旋转 
V
T
 
 的信息。
 
G
 
 是格林应变张量，表示形状的变形。
格林应变张量是旋转不变的，这意味着即使材料发生旋转，格林应变张量的值也不会改变。这使得格林应变张量在描述材料的变形时非常有用，因为它只关注变形的程度，而不受坐标系旋转的影响。
总之，格林应变张量 
G
 可以表示为：

 
G
=
1
2
(
F
T
F
−
I
)
 

其中：
 
F
 
 是变形梯度矩阵。
 
I
 是单位矩阵。

格林应变张量的元素可以写为：

 
G
=
[
ε
u
u
ε
u
v
ε
u
v
ε
v
v
]
 
正应变： 
ε
u
u
 和 
ε
v
v
 
 描述了材料在 
u
 
 方向和 
v
 
 方向上的伸长或缩短，正应变反映了材料在特定方向上的线性变形。
剪切应变： 
ε
u
v
 描述了材料在 
u
 
  方向和 
v
 
 方向之间的相对滑移。剪切应变反映了材料在两个正交方向之间的角度变化，即材料的形状变化。
因为格林应变张量和位移，旋转都无关，仅仅描述了材料（实例图中的三角形）的形变。 
u
 和 
v
 是材料坐标系中的两个正交方向。在二维问题中，这两个方向通常与材料的几何形状和边界条件有关。例如，在一个平面应变问题中，
u
 和 
v
可以分别对应于材料的两个主要方向，如水平方向和垂直方向。
假设我们有一个二维材料（平板），其几何形状和边界条件如下：

u
方向：水平方向（平板的长度方向）。
v
方向：垂直方向（平板的宽度方向）。

在这种情况下：

 
ε
u
u
 描述了材料在水平方向上的伸长或缩短。
 
ε
v
v
 描述了材料在垂直方向上的伸长或缩短。
 
ε
u
v
 描述了材料在水平方向和垂直方向之间的相对滑移。

 
G
=
[
ε
u
u
ε
u
v
ε
u
v
ε
v
v
]
 
格林应变张量的元素可以通过位移场 
u
(
x
,
y
)
 和 
v
(
x
,
y
)
 
 来计算：

 
ε
u
u
=
∂
u
∂
x
 
ε
v
v
=
∂
v
∂
y
 
ε
u
v
=
1
2
(
∂
u
∂
y
+
∂
v
∂
x
)
 
 

其中：
 
u
(
x
,
y
)
 是 
x
 
 方向的位移。
 
v
(
x
,
y
)
 是  
y
 
 方向的位移。
总之：
u
方向和
v
方向是材料坐标系中的两个正交方向，用于描述材料在不同方向上的伸长、缩短和剪切变形。这些方向的选择取决于具体问题的几何和边界条件。通过格林应变张量，可以全面描述材料的变形状态。
Saint Venant-Kirchhoff 模型 & 能量密度 
W
(
G
)
格林应变张量 
G
 
 描述了材料的形变，通俗地理解，形变导致了弹性能量的出现，因此可以通过格林应变来描述能量密度 
W
(
G
)
 。在连续介质力学中，能量密度 
W
(
G
)
 
 描述了材料在变形过程中储存的能量，描述了材料在给定变形状态下的能量存储情况。这里使用 Saint Venant-Kirchhoff 模型（StVK 模型）将格林应变映射到能量密度 
W
(
G
)
 。
在 Saint Venant-Kirchhoff 模型中，能量密度 
W
(
G
)
 可以表示为格林应变张量的函数，描述了单位参考面积上的能量密度。具体来说：

 
W
(
G
)
=
λ
2
(
ε
u
u
+
ε
v
v
)
2
+
μ
(
ε
u
u
2
+
ε
v
v
2
+
2
ε
u
v
2
)
 

其中：
 
λ
 和 
μ
 是拉梅参数（Lamé parameters），它们是材料的弹性常数，用于描述材料的弹性行为。
 
ε
u
u
 
 , 
ε
v
v
 , 和 
ε
u
v
 
 是格林应变张量的元素，分别表示沿 
u
 
 方向和 
v
 
 方向的正应变以及
u
 
和
v
 
方向之间的剪切应变。
拉梅参数 
λ
 
 和 
μ
 :
λ
 
 和 
μ
是材料的两个独立弹性常数，用于描述材料的弹性行为。
λ
 
 通常被称为第一拉梅常数，与材料的体积变化有关。
 
μ
通常被称为剪切模量，与材料的形状变化（剪切变形）有关。
W
(
G
)
=
λ
2
(
ε
u
u
+
ε
v
v
)
2
+
μ
(
ε
u
u
2
+
ε
v
v
2
+
2
ε
u
v
2
)
  有两项，分别描述了材料在体积变化时的能量存储和材料在形状变化（剪切变形）时的能量存储。
体积变化能量:
 
λ
2
(
ε
u
u
+
ε
v
v
)
2
 描述了材料在体积变化时的能量存储。当材料在两个正交方向上同时伸长或缩短时，这部分能量会增加。

形状变化能量:
 
μ
(
ε
u
u
2
+
ε
v
v
2
+
2
ε
u
v
2
)
 描述了材料在形状变化时的能量存储。这部分能量与材料的剪切变形有关，当材料发生剪切变形时，这部分能量会增加。
在有限元分析中，Saint Venant-Kirchhoff 模型常用于描述材料的弹性行为。
W
(
G
)
 对于 
G
 的导数值得注意
好的，图中的连等式如下：

∂
W
∂
G
=
[
∂
W
∂
ε
u
u
1
2
∂
W
∂
ε
u
v
1
2
∂
W
∂
ε
u
v
∂
W
∂
ε
v
v
]
=
[
2
μ
ε
u
u
+
λ
ε
u
u
+
λ
ε
v
v
2
μ
ε
u
v
2
μ
ε
u
v
2
μ
ε
v
v
+
λ
ε
u
u
+
λ
ε
v
v
]
=
2
μ
G
+
λ
trace
(
G
)
I
=
S
 
求导结果 
S
 是第二皮奥拉-基尔霍夫应力张量（Second Piola-Kirchhoff Stress Tensor）。
理解其物理含义，在后续的FVM会用到。简单理解如下：
在离散系统中，能量对位移求导给出的是作用在该点的力；这里的 
W
 是能量密度，而 
G
 描述了形变，也可以类比成位移，所以求导的结果Second Piola-Kirchhoff Stress Tensor应该是一个类似于描述力的密度的量。
幸运的是，这样想当然的理解没有太大的偏差。在连续介质中，应变能密度
W
（形变引发的能量的密度）对格林应变张量
G
求导给出的是作用在该点的应力，这是一种是一种描述单位面积上的内力分布的量。
在有限元分析中， 
S
 确定了材料内部的力分布，这些力抵抗外部施加的载荷或边界条件引起的变形。在后续的FVM中，探讨了应力张量（stress）和牵引力（traction）之间的关系， 
S
 可以将任意面元的法向量映射到该面上的牵引力（traction）。
在连续介质力学中，stress 和 traction 的关系可以通过以下公式表达：

 
t
=
P
⋅
n
 

这里：
 
t
 是表面上的牵引力向量（traction vector），表示作用在给定表面上的力。
 
P
 是第一皮奥拉-基尔霍夫应力张量（First Piola-Kirchhoff Stress Tensor），它关联了参考构型和当前构型中的应力。
 
n
 是参考构型中表面的单位法向量。

对于第二皮奥拉-基尔霍夫应力张量  ，我们需要通过变形梯度  将其转换为第一皮奥拉-基尔霍夫应力张量  ，然后才能应用上述公式。原因后续的FVM会作解释。

综上所述，  对  的导数确实给出了一个类似于“力”的量——应力张量  ，它不仅描述了材料内部的力分布，还能够用于计算作用在特定表面上的牵引力。这个过程是有限元方法中求解结构力学问题的核心部分。
拓展一下描述材料弹性行为的不同模型：
刚才提到的Saint Venant-Kirchhoff 模型是一种描述小变形情况下的材料弹性行为的模型。它适用于金属等在小变形范围内表现出线性弹性行为的材料。
Neo-Hookean 模型是一种描述超弹性材料（如橡胶、生物组织等）的模型。它特别适用于大变形情况下的材料，因为这些材料在大变形时仍然保持弹性行为。它在有限元分析中广泛应用于模拟大变形问题，简单且能够有效捕捉材料的体积不可压缩特性。
Neo-Hookean 模型的能量密度函数  可以表示为：

  
其中：
  是剪切模量
  是第一拉梅常数
  是一个常数，用于确保能量密度在零应变时为零
  是变形梯度张量
  是体积变化因子。

第一项  描述了材料的剪切变形能。
第二项  强烈惩罚体积变化，使得材料倾向于保持其原始体积。
第三项  是一个附加项，用于进一步稳定模型，特别是对于大变形情况。
总能量 
通过 Saint Venant-Kirchhoff 模型，能量密度  可以表示为格林应变张量的函数。这个模型将格林应变张量的各个分量映射到能量密度，从而描述了材料在变形过程中储存的能量。
随后在每个三角形的面积上对能量密度  进行积分，得到总能量  。
 
 是总能量。
 是能量密度。
 是面积元。
 是参考面积。
 是格林应变张量的元素。
顶点  所受的力 
对总能量  关于顶点位置  求导，并加上负号，得到顶点  所受的力  。
求导的细节下次再写











